import{a as e,_ as a,f as t}from"./index-5966096b.js";/* empty css            *//* empty css        */import{l,a as s,Z as o,d as n,m as i,p as r,q as u,U as d,O as c,S as m,F as p,a7 as f,u as b,M as g,a2 as v,T as S}from"./vue.js";import{b as N,t as h,e as j}from"./tkManagePage.js";import{k as y,m as D,q as _,r as I,x as k,y as w}from"./element.js";import"./lib.js";/* empty css          */const A={class:"select-multi"},V={class:"select-multi_opts"},x=l({name:"CompSelectMulti"});var T=a(Object.assign(x,{props:{datas:{type:Array,default:()=>[]},maxLimit:{type:Number,default:2}},setup(a,{expose:t}){const l=e(),S=a;let h=s(!1),j=o({tableName:[]}),k=s([]),w=s([]),x=o({currentPage:1,pageSize:5,total:2});const T=s();function O(){w.value=Object.keys(S.datas).map((e=>({tableName:e,_disabled:!1}))),x.total=w.value.length,P(),sessionStorage.setItem("allSelected",""),sessionStorage.setItem("popPrevAllSelected","")}function P(){j.tableName=[]}function C(){k.value=w.value.slice((x.currentPage-1)*x.pageSize,x.currentPage*x.pageSize),l.setListData(k.value),l.setListTotal(w.value.total),function(){const e=JSON.parse(sessionStorage.getItem("allSelected")||"[]").map((e=>e.tableName));k.value.forEach((a=>{e.includes(a.tableName)}))}(),J()}function q(){const e=JSON.parse(sessionStorage.getItem("allSelected")||"[]");e.map((e=>e.tableName)),P(),e.forEach((e=>{j.tableName.push({key:new Date,value:e.tableName})})),z("popPrevAllSelected"),h.value=!1}function E(){sessionStorage.setItem("allSelected",sessionStorage.getItem("popPrevAllSelected")),h.value=!1}function U(e){h.value=e}function L(e){x.currentPage=e,C()}function F(e){x.pageSize=e,C()}function R(e){sessionStorage.setItem("allSelected",JSON.stringify(e)),J()}function J(){const e=JSON.parse(sessionStorage.getItem("allSelected")||"[]").map((e=>e.tableName)),a=e.length>=S.maxLimit;k.value.forEach((t=>{e.includes(t.tableName)?t._disabled=!1:t._disabled=a}))}function $(){h.value=!0,C(),z("popPrevAllSelected")}function z(e){sessionStorage.setItem(e,sessionStorage.getItem("allSelected")||"[]")}return t(j),n((()=>{O()})),(e,a)=>{const t=y,l=D,s=_,o=I;return i(),r("div",A,[u("div",V,[d(t,{onClick:$},{default:c((()=>[m("添加")])),_:1})]),d(o,{model:b(j),"label-width":"100px",width:"500px"},{default:c((()=>[(i(!0),r(p,null,f(b(j).tableName,((e,a)=>(i(),g(s,{label:`文件${a+1}：`,key:e.value,prop:`tableName${0===a?"":a}`},{default:c((()=>[d(l,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,disabled:!0},null,8,["modelValue","onUpdate:modelValue"]),d(t,{onClick:v((a=>function(e){var a=j.tableName.findIndex((a=>a.value===e.value));j.tableName.splice(a,1);const t=JSON.parse(sessionStorage.getItem("allSelected")||"[]").filter((a=>a.tableName!==e.value));sessionStorage.setItem("allSelected",JSON.stringify(t)),z("popPrevAllSelected")}(e)),["prevent"])},{default:c((()=>[m("删除")])),_:2},1032,["onClick"])])),_:2},1032,["label","prop"])))),128))])),_:1},8,["model"]),d(N,{ref_key:"dialogRef",ref:T,width:"680px",title:"选择数据",showForm:!1,showTable:!0,hasOption:!1,showIndex:!1,showSelect:!0,editFormVisible:b(h),pageparm:b(x),listData:b(k),onHandleCurrentChange:L,onHandleSizeChange:F,onCloseDialog:E,onSave:q,onChangeVisible:U,onSelect:R},null,8,["editFormVisible","pageparm","listData"])])}}}),[["__scopeId","data-v-3818a03c"]]),O={grade:["gradeName","gradeID","createdAt","updatedAt"],subject:["subjectName","subjectID","subjectType","createdAt","updatedAt"],type:["typeID","subjectType","createdAt","updatedAt"],yesno:["questionContent","questionID","questionAnswer","questionScore","questionDifficult","questionAnalysis","subjectName","gradeName","createdAt","updatedAt"],unit:["unitName","unitID","createdAt","updatedAt"],word:["wordName","wordID","subjectType","wordTranslate","wordPronunciation","wordAssociation","wordGrammar","wordSentence","wordSentenceTranslate","wordExpression","unitName","gradeName","createdAt","updatedAt"],taskPlan:["planTask","taskPlanID","userName","planTimeStart","planTimeEnd","planStatus","planDesc","planMemo","taskType","subjectName","gradeName","createdAt","updatedAt"],taskType:["taskType","taskTypeID","createdAt","updatedAt"]};const P={__name:"jsonParser",setup(e){const{$message:a}=j,{validator:l}=h(),n=s(),r=s(),u=s("2"),p=o({fileDir:"tiku",fileName:"type",jsonData:""}),f={fileDir:[{required:!0,validator:l,trigger:"blur"}],fileName:[{required:!0,validator:l,trigger:"blur"}],jsonData:[{validator:l,trigger:"blur"}]};function v(e){n.value.clearValidate([e])}function N(){p.jsonData=""}function A(e){const a=O[e],l=`http://localhost:8000/${p.fileDir}/${e}.json`;fetch(l).then((async e=>{const l=await e.json();let s=[];l.forEach((e=>{Object.keys(e).forEach((a=>{if(["_id"].includes(a))delete e[a];else if(!["string","number"].includes(typeof e[a])){const l=Object.values(e[a])[0];e[a]=t(l)}}));const l=function(e,a){let t="(";return a.forEach(((l,s)=>{const o=e[l];t+="string"==typeof o?`"${e[l]}"`:e[l],t+=s===a.length-1?"":","})),t+=")",t}(e,a);s.push(l)})),p.jsonData+="INSERT INTO `"+p.fileName+"` VALUES "+s.join(",")+";\n"})).catch((e=>{}))}async function V(){try{if(p.jsonData="","1"===u.value){await n.value.validateField(["fileDir","fileName"])&&A(p.fileName)}else{await n.value.validateField(["fileDir"])&&r.value.tableName.length>0?r.value.tableName.forEach((e=>{A(e.value)})):a.error("请先添加文件")}}catch(e){}}async function x(){try{if(await n.value.validateField("jsonData")){const e=new Blob([p.jsonData],{type:"text/sql;charset=utf-8"}),a=URL.createObjectURL(e),t=document.createElement("a");t.href=a,t.download="tiku.sql",t.click(),URL.revokeObjectURL(a)}}catch(e){}}return(e,a)=>{const t=D,l=_,s=k,o=w,h=y,j=I;return i(),g(j,{ref_key:"formRef",ref:n,"label-width":"80",model:p,rules:f},{default:c((()=>[d(l,{label:"文件路径",prop:"fileDir"},{default:c((()=>[d(t,{modelValue:p.fileDir,"onUpdate:modelValue":a[0]||(a[0]=e=>p.fileDir=e),placeholder:"输入文件路径",clearable:"",onInput:a[1]||(a[1]=e=>v("fileDir"))},null,8,["modelValue"])])),_:1}),d(l,{label:"类型选择"},{default:c((()=>[d(o,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value=e),onChange:N},{default:c((()=>[d(s,{label:"1"},{default:c((()=>[m("解析单个")])),_:1}),d(s,{label:"2"},{default:c((()=>[m("解析多个")])),_:1})])),_:1},8,["modelValue"])])),_:1}),d(l,{label:"文件解析",prop:"fileName"},{default:c((()=>["1"===u.value?(i(),g(t,{key:0,modelValue:p.fileName,"onUpdate:modelValue":a[3]||(a[3]=e=>p.fileName=e),placeholder:"输入单个文件名称",clearable:"",onInput:a[4]||(a[4]=e=>v("fileName"))},{prepend:c((()=>[m(S("http://localhost:8000"))])),prefix:c((()=>[m(" /"+S(p.fileDir)+"/",1)])),suffix:c((()=>[m(S(".json"))])),_:1},8,["modelValue"])):(i(),g(T,{key:1,ref_key:"addFilesRef",ref:r,datas:b(O),"max-limit":100},null,8,["datas"]))])),_:1}),d(l,{label:"解析结果",prop:"jsonData"},{default:c((()=>[d(t,{modelValue:p.jsonData,"onUpdate:modelValue":a[5]||(a[5]=e=>p.jsonData=e),rows:"10",type:"textarea",onInput:a[6]||(a[6]=e=>v("jsonData"))},null,8,["modelValue"])])),_:1}),d(l,null,{default:c((()=>[d(h,{onClick:V},{default:c((()=>[m("解析")])),_:1}),d(h,{onClick:x},{default:c((()=>[m("下载")])),_:1})])),_:1})])),_:1},8,["model"])}}};export{P as default};
